---
title: "Exercise 2"
author: "Adam Sulak, Onder Akacik, Arda Ergin"
date: "2024-02-22"
output:
  pdf_document: default
  html_document: default
---

```{r,echo=FALSE}
source("../Packages.R")
```

# Exercise 2
```{r}
data <- read.table("hemoglobin-1.txt", header = TRUE)
```

## Question 2a)
```{r}
# Initializing the DF with an ID column
mock_data <- as.data.frame(matrix(1:80,80)); colnames(mock_data) <- "ID"
# Randomizing 8 experimental groups (since it is a 2x4 design) 
mock_data$condition <- sample(rep(1:8, 10), replace=F)
# Creating the two conditions
mock_data <- mock_data %>% dplyr::mutate(
  method = factor(
    case_when(
      condition <= 4 ~ 0,
      TRUE ~ 1),
    levels = 0:1,
    labels = c("A","B"))) %>% dplyr::mutate(
  rates = factor(
    case_when(
      condition <= 4 ~ as.numeric(condition)-1,
      condition >= 5 ~ as.numeric(condition)-5),
    levels = 0:3,
    labels = c("0mg","5mg","10mg","15mg")))
```


## Question 2b)

First, **factorizing** the variables:
```{r}
data$method <- factor(data$method)
data$rate <- factor(
  data$rate,
  levels = 1:4,
  labels = c("0mg","5mg","10mg","15mg"), ordered=T)
```

**Modelling and Two-way ANOVA**:
```{r}
model <- lm(hemoglobin ~ method*rate, data = data)
anova(model)
```

The results of the ANOVA shows that while the `rate` variable has a significant main effect on hemoglobin levels, $F(3, 72) = 19.47$, $p < 0.001$, the main effect of `method` variable on hemoglobin levels is not significant, $F(1, 72) = 1.56$, $p = 0.22$. The `method:rate` interaction is also not significant, $F(3, 72) = 1.05$, $p = 0.38$.


## Question 1c)

The **rate** of sulfamerazine has the greatest influence on hemoglobin levels among two that were tested. It has a statistically significant effect. This question is a good starting point for understanding the effects of different variables on a response.

```{r}
# additive model
anova_result <- anova(lm(hemoglobin ~ rate + method, data = hemoglobin_data))
anova_result

```

Combination: **rate:2** and **method:B** yielded the highest hemoglobin.

**Mean value** for **rate:3** and **method:A** can be used as the **estimate** of that combination, which leads to the value of **9.03**.

**Rate 2** leads to the highest mean hemoglobin as it can be seen from the printed sorted means per combination. **Rate 3** is the second and **Rate 4** is the third and **Rate 1** is the fourth.

```{r}
mean_hemoglobin_by_combination <- aggregate(
    hemoglobin ~ rate + method,
    data = hemoglobin_data,
    FUN = mean
)

sorted_means <- mean_hemoglobin_by_combination[order(-mean_hemoglobin_by_combination$hemoglobin), ]

print(sorted_means)

```

## Question D)

Performing this test is useful to understand the effect of the rate variable alone on hemoglobin levels, but it's important to remember that ignoring other variables (like the method in this case) might oversimplify the model and overlook potential interaction effects.

The rate of sulfamerazine does have a significant effect on hemoglobin levels, so the **null hypothesis is rejected.**

Estimated hemoglobin values for each rate are **Rate1 6.975, Rate2 9.735, Rate3 9.380, and Rate4 8.855**. Performing this test is useful to understand the effect of the rate variable alone on hemoglobin levels, but it's important to remember that ignoring other variables (like the method in this case) might oversimplify the model and overlook potential interaction effects.

```{r}

hemoglobin_data$rate <- as.factor(hemoglobin_data$rate)

anova_result_one_way <- anova(lm(hemoglobin ~ rate, data = hemoglobin_data))
print(anova_result_one_way)

mean_hemoglobin_by_rate <- aggregate(
    hemoglobin ~ rate,
    data = hemoglobin_data,
    FUN = mean
)
print(mean_hemoglobin_by_rate)

```

## Question E)

A non-parametric alternative to one-way ANOVA is Kruskal-Wallis test. We run the test with command below to to compare output with results from section D.

```{r}
kruskal_result <- kruskal.test(hemoglobin_data$hemoglobin, hemoglobin_data$rate)
print(kruskal_result)
```

The results of Kruskal-Wallis test are consistent with those from section D. We clearly see that hemoglobin levels are affected by the rate factor. The p-value is equal to 1.777e-07 which mean **Null hypothesis is rejected** again.
